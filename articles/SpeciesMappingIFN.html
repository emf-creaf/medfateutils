<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Species mapping for the Spanish NFI • medfateutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Species mapping for the Spanish NFI">
<meta property="og:description" content="medfateutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Species mapping for the Spanish NFI</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2024-05-23</h4>
      
      
      <div class="hidden name"><code>SpeciesMappingIFN.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes the procedures used to obtain a set of taxon
entities to be used in medfate, which intend to cover most of the woody
plant taxa in Spain, as they are reported in the Spanish National Forest
Inventory surveys (<em>Inventario Forestal Nacional</em> or IFN).</p>
<p>The vignette is not self-contained, in the sense that it cannot be
reproduced without access to data sets that are not included.
Nevertheless, it is intended to serve as example of species
parameterization for other regions.</p>
<div class="section level3">
<h3 id="required-packages">Required packages`<a class="anchor" aria-label="anchor" href="#required-packages"></a>
</h3>
<p>Installed version of <strong>medfate</strong> should be <strong>ver
2.9</strong> or higher.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"medfate"</span><span class="op">)</span></span></code></pre></div>
<p>If the version at CRAN is older, the package should be installed from
GitHub via <code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"emf-creaf/medfate"</span><span class="op">)</span></span></code></pre></div>
<p>Package <strong>medfateutils</strong> is required for the species
parameterization process, as it includes several functions that
facilitate parsing data sources into parameter values. Package
<strong>medfateutils</strong> is installed only from GitHub:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"emf-creaf/medfateutils"</span><span class="op">)</span></span></code></pre></div>
<p>Once we have <strong>medfate</strong> and
<strong>medfateutils</strong>, we load them and other common packages
that we will employ in this vignette:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emf-creaf.github.io/medfate/" class="external-link">medfate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">medfateutils</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: replacing previous import 'dplyr::filter' by 'stats::filter' when</span></span>
<span><span class="co">## loading 'medfateutils'</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="source-data-paths">Source data paths<a class="anchor" aria-label="anchor" href="#source-data-paths"></a>
</h3>
<p>Befores starting, we define file paths (in my computer) to access
source data for parameter filling. Source data includes forest inventory
(i.e. IFN) data as well as plant trait and allometric data bases:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IFN_path</span> <span class="op">=</span> <span class="st">"/home/miquel/OneDrive/EMF_datasets/ForestInventories/IFN/"</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="load-ifn-taxon-codes">Load IFN taxon codes<a class="anchor" aria-label="anchor" href="#load-ifn-taxon-codes"></a>
</h2>
<p>Model simulations will normally entail a lower biological resolution
of target entities than used in forest inventory data, because the finer
the biological resolution the large the number of missing parameter
values. Therefore, it will be usual to consider together entities that
are treated as distinct in the forest inventory.</p>
<p>In our case, we begin by loading shrub and tree species codes used in
the second, third, and fourth editions of IFN, i.e. IFN2, IFN3 and
IFN4:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IFN23_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/SpeciesCodesIFN23.txt"</span><span class="op">)</span>, </span>
<span>                             sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="va">IFN23_species_data</span><span class="op">&lt;-</span><span class="va">IFN23_species_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">IFN4_shrub_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/shrubcodesifn4.txt"</span><span class="op">)</span>, </span>
<span>                             sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span></span>
<span><span class="va">IFN4_tree_species_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">IFN_path</span>,<span class="st">"Sources/treecodesifn4.txt"</span><span class="op">)</span>, </span>
<span>                                    sep<span class="op">=</span><span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span></span>
<span><span class="va">IFN4_tree_species_data</span><span class="op">&lt;-</span><span class="va">IFN4_tree_species_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>Merge the two code data sets by adding to the codes of IFN2-3 those
species codes that were new in IFN4:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">newShrubs</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="va">IFN4_shrub_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span></span>
<span><span class="va">newTrees</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="op">(</span><span class="va">IFN4_tree_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">IFN23_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span></span>
<span><span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">IFN23_species_data</span>, </span>
<span>                              <span class="va">IFN4_shrub_species_data</span><span class="op">[</span><span class="va">newShrubs</span>, <span class="op">]</span>, </span>
<span>                              <span class="va">IFN4_tree_species_data</span><span class="op">[</span><span class="va">newTrees</span>,<span class="op">]</span><span class="op">)</span></span>
<span><span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="va">IFN_species_data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Check uniqueness of codes:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>The final table of species names and codes has 469 rows and looks
like:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   IFNCODE               IFNNAME</span></span>
<span><span class="co">## 1       1 Heberdenia bahamensis</span></span>
<span><span class="co">## 2       2    Amelanchier ovalis</span></span>
<span><span class="co">## 3       3        Frangula alnus</span></span>
<span><span class="co">## 4       4     Rhamnus alaternus</span></span>
<span><span class="co">## 5       5    Euonymus europaeus</span></span>
<span><span class="co">## 6       6       Myrtus communis</span></span></code></pre>
<p>So far, we used the word <em>species</em> for IFN biological
entities, but in fact not all IFN entities are binomial species. In some
cases, subspecies are recorded, while in others identification is at
genus level or even uses non-scientific names. Hence, the set of
entities needs to be revised and we illustrate the process in the
following two sections.</p>
</div>
<div class="section level2">
<h2 id="define-ifn-codes-to-exclude">Define IFN codes to exclude<a class="anchor" aria-label="anchor" href="#define-ifn-codes-to-exclude"></a>
</h2>
<p>We need to manually define a set of entities (IFN codes) to be
excluded because they have low taxonomic information, refer to habitat
descriptions or to undesired growth forms (e.g. vines):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codesOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"19"</span>, <span class="co"># Otras coniferas </span></span>
<span>              <span class="st">"10"</span>, <span class="co"># Sin asignar</span></span>
<span>              <span class="st">"20"</span>, <span class="co"># Pinos</span></span>
<span>              <span class="st">"29"</span>, <span class="co"># Otros pinos</span></span>
<span>              <span class="st">"30"</span>,  <span class="co">#Mezcla de coniferas</span></span>
<span>              <span class="st">"40"</span>, <span class="co">#Quercus</span></span>
<span>              <span class="st">"49"</span>, <span class="co">#Otros quercus</span></span>
<span>              <span class="st">"50"</span>, <span class="co">#Mezcla de &lt;e1&gt;rboles de ribera</span></span>
<span>              <span class="st">"59"</span>, <span class="co">#Otros &lt;e1&gt;rboles rip&lt;ed&gt;colas</span></span>
<span>              <span class="st">"70"</span>, <span class="co">#Mezcla de frondosas de gran porte</span></span>
<span>              <span class="st">"80"</span>, <span class="co">#Laurisilva</span></span>
<span>              <span class="st">"89"</span>, <span class="co">#Otras laurisilvas</span></span>
<span>              <span class="st">"90"</span>, <span class="co">#Mezcla de peque&lt;f1&gt;as frondosas</span></span>
<span>              <span class="st">"99"</span>, <span class="co">#Otras frondosas</span></span>
<span>              <span class="st">"1500"</span>, <span class="co"># Cultivo en mosaico</span></span>
<span>              <span class="st">"8000"</span>, <span class="co"># Matorral en mosaico</span></span>
<span>              <span class="st">"9000"</span>, <span class="co">#Herbazal en mosaico</span></span>
<span>              <span class="st">"3400"</span>, <span class="co">#Prado en mosaico</span></span>
<span>              <span class="st">"3500"</span>, <span class="co">#Pastizal-Matorral en mosaico</span></span>
<span>              <span class="st">"103"</span>, <span class="co">#Otras papilionoideas altas</span></span>
<span>              <span class="st">"104"</span> <span class="co">#Otras papilionoideas bajas</span></span>
<span>              <span class="op">)</span></span></code></pre></div>
<p>We remove taxa from the IFN taxonomic definition data frame:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IFN_species_data</span> <span class="op">&lt;-</span> <span class="va">IFN_species_data</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">codesOut</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>so that we are left with 448 taxa.</p>
</div>
<div class="section level2">
<h2 id="define-taxonomic-entities-to-merge-into-groups">Define taxonomic entities to merge into groups<a class="anchor" aria-label="anchor" href="#define-taxonomic-entities-to-merge-into-groups"></a>
</h2>
<p>As mentioned above, simulations will normally require defining groups
of entities to be treated together in <strong>medfate</strong>. In our
case, we need to define some genus-level groups because the forest
inventory records do not always have identifications at species-level
resolution:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genus_level</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acacia spp.:7/207/307"</span>,</span>
<span>                 <span class="st">"Adenocarpus spp.:1163/2163/2103/3163/10103"</span>,</span>
<span>                 <span class="st">"Anagyris spp.:175/1175"</span>,</span>
<span>                 <span class="st">"Atriplex spp.:133"</span>,</span>
<span>                 <span class="st">"Artemisia spp.:126/159/1159/3159"</span>,</span>
<span>                 <span class="st">"Asparagus spp.:138/1138/2138"</span>,</span>
<span>                 <span class="st">"Astragalus spp.:6104"</span>,</span>
<span>                 <span class="st">"Betula spp.:73/273/373"</span>,</span>
<span>                 <span class="st">"Bupleurum spp.:124/1124/2124/4124"</span>,</span>
<span>                 <span class="st">"Calicotome spp.:2104/2105/9072/3104"</span>,</span>
<span>                 <span class="st">"Cedrus spp.:17/217/317/917"</span>,</span>
<span>                 <span class="st">"Corema spp.:172/1172"</span>,</span>
<span>                 <span class="st">"Chamaerops humilis:369/3690"</span>,</span>
<span>                 <span class="st">"Clematis spp.:132/1132/2132"</span>,</span>
<span>                 <span class="st">"Crataegus spp.:15/215/315/415/515"</span>,</span>
<span>                 <span class="st">"Coronilla spp.:152/1152/3152/5104"</span>,</span>
<span>                 <span class="st">"Cotoneaster spp.:118"</span>,</span>
<span>                 <span class="st">"Cupressus spp.:36/236/336/436/936"</span>,</span>
<span>                 <span class="st">"Daphne spp.:110/1110/2110/3110"</span>,</span>
<span>                 <span class="st">"Dorycnium spp.:154/7104/1154"</span>,</span>
<span>                 <span class="st">"Echium spp..:161"</span>,</span>
<span>                 <span class="st">"Ephedra spp.:173/1173"</span>,</span>
<span>                 <span class="st">"Erinacea spp.:1104/1166"</span>,</span>
<span>                 <span class="st">"Eucalyptus spp.:60/61/62/63/64/264/364/464"</span>,</span>
<span>                 <span class="st">"Euphorbia spp.:162/1162/2162/3162"</span>,</span>
<span>                 <span class="st">"Fraxinus spp.:55/255/355/455/955"</span>,</span>
<span>                 <span class="st">"Genista spp.:177/1177/155/1155/1255/1355/1455/1555/1755/1156/1655/2155/2156/3155/4155/6155/7155/8155/9075/9155/10155/11155/12155/13155/14155"</span>,</span>
<span>                 <span class="st">"Genistella spp.:9104"</span>,</span>
<span>                 <span class="st">"Halimium spp.:117/1117/2117/3117/4117/5117/6117"</span>,</span>
<span>                 <span class="st">"Helianthemum spp.:142"</span>,</span>
<span>                 <span class="st">"Helichrysum spp.:128/1128/2128"</span>,</span>
<span>                 <span class="st">"Larix spp.:35/235/335/435"</span>,</span>
<span>                 <span class="st">"Lavandula spp.:109/1109/2109/3109/4109"</span>,</span>
<span>                 <span class="st">"Lonicera spp.:144/1144/2144/3144/4144/5144/9012"</span>,</span>
<span>                 <span class="st">"Ilex spp.:65/82/282"</span>,</span>
<span>                 <span class="st">"Juglans spp.:75/275/975"</span>,</span>
<span>                 <span class="st">"Laurus spp.:94/294"</span>,</span>
<span>                 <span class="st">"Maytenus spp.:158/1158"</span>,</span>
<span>                 <span class="st">"Morus spp.:399/499/599"</span>,</span>
<span>                 <span class="st">"Ononis spp.:156/8104"</span>,</span>
<span>                 <span class="st">"Osyris spp.:135/1135/2135"</span>,</span>
<span>                 <span class="st">"Platanus spp.:79/279"</span>,</span>
<span>                 <span class="st">"Populus spp.:51/52/58/258"</span>,</span>
<span>                 <span class="st">"Phlomis spp.:171/1171/2171"</span>,</span>
<span>                 <span class="st">"Phoenix spp.:69/269/469"</span>,</span>
<span>                 <span class="st">"Prunus spp.:95/295/395/495/595/1095/1195/2950/148"</span>,</span>
<span>                 <span class="st">"Pyrus spp.:16"</span>,</span>
<span>                 <span class="st">"Retama spp.:4103/1165/2165"</span>,</span>
<span>                 <span class="st">"Rhamnus spp.:4/122/1122/2122/3122/4122/389/5122/6122"</span>,</span>
<span>                 <span class="st">"Rhododendron spp.:108/1108/2108"</span>,</span>
<span>                 <span class="st">"Ribes spp.:131/1131/2131"</span>,</span>
<span>                 <span class="st">"Rosa spp.:119"</span>,</span>
<span>                 <span class="st">"Rubus spp.:121/1121/2121/3121"</span>,</span>
<span>                 <span class="st">"Ruscus spp.:130/1130"</span>,</span>
<span>                 <span class="st">"Salix spp.:57/257/357/457/557/657/757/857/858/957"</span>,</span>
<span>                 <span class="st">"Sambucus spp.:97/197/297/997/2970"</span>,</span>
<span>                 <span class="st">"Santolina spp.:127/1127/2127"</span>,</span>
<span>                 <span class="st">"Sorbus spp.:78/278/378/478/578/678/778"</span>,</span>
<span>                 <span class="st">"Spartium spp.:3103/9103"</span>,</span>
<span>                 <span class="st">"Spiraea spp.:134/1134"</span>,</span>
<span>                 <span class="st">"Tamarix spp.:53/253"</span>,</span>
<span>                 <span class="st">"Teline spp.:165/9077/9078/9202/9914"</span>,</span>
<span>                 <span class="st">"Teucrium spp.:179/1179"</span>,</span>
<span>                 <span class="st">"Tilia spp.:77/277/377"</span>,</span>
<span>                 <span class="st">"Thymelaea spp.:151"</span>,</span>
<span>                 <span class="st">"Thuja spp.:319"</span>,</span>
<span>                 <span class="st">"Thymus spp.:129/1129/2129/3129/4129/5129"</span>,</span>
<span>                 <span class="st">"Ulex spp.:157/176/1103/6103/1164/3164"</span>, <span class="co">#Merges Stauracanthus</span></span>
<span>                 <span class="st">"Ulmus spp.:56/256/356/456/956"</span>,</span>
<span>                 <span class="st">"Vaccinium spp.:137/1137"</span>,</span>
<span>                 <span class="st">"Vella spp.:170/1170"</span>,</span>
<span>                 <span class="st">"Viburnum spp.:115/1115/4115/3115/2115"</span></span>
<span>                 <span class="op">)</span></span></code></pre></div>
<p>Groups were manually defined as strings where ‘:’ was used to
separate the group name from the set of codes forming the group, which
were separated using ‘/’. We also define groups of taxa at species
level, where different synonyms are merged, different codes have been
used for the same species, or to merge sub-specific records:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">assimilated_species</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Acer campestre:76/776/976"</span>,</span>
<span>                       <span class="st">"Amelanchier ovalis:2/200"</span>,</span>
<span>                       <span class="st">"Buxus sempervirens:91/291/2910/9071/9100"</span>,</span>
<span>                       <span class="st">"Cistus albidus:101/3101"</span>,</span>
<span>                       <span class="st">"Cistus psilosepalus:2111/11101"</span>,</span>
<span>                       <span class="st">"Cornus sanguinea:9/900"</span>,</span>
<span>                       <span class="st">"Cytisus fontanesii:9074"</span>,</span>
<span>                       <span class="st">"Cytisus scoparius:4104/1167/5103/8103"</span>,</span>
<span>                       <span class="st">"Cytisus commutatus:9011/9201/9481"</span>,</span>
<span>                       <span class="st">"Cytisus oromediterraneus:5155/4167"</span>,</span>
<span>                       <span class="st">"Erica scoparia:283/6102"</span>,</span>
<span>                       <span class="st">"Erica arborea:83/102/1102"</span>,</span>
<span>                       <span class="st">"Euonymus europaeus:5/500"</span>,</span>
<span>                       <span class="st">"Frangula alnus:3/300"</span>,</span>
<span>                       <span class="st">"Juniperus communis:37/937/3700"</span>,</span>
<span>                       <span class="st">"Juniperus phoenicea:39/238/239/1139"</span>,</span>
<span>                       <span class="st">"Medicago arborea:145/9076"</span>,</span>
<span>                       <span class="st">"Myrtus communis:6/600"</span>,</span>
<span>                       <span class="st">"Myrica faya:81/281"</span>,</span>
<span>                       <span class="st">"Pistacia terebinthus:93/9300"</span>,</span>
<span>                       <span class="st">"Quercus ilex:45/245"</span>,</span>
<span>                       <span class="st">"Quercus faginea:44/344"</span>,</span>
<span>                       <span class="st">"Quercus suber:46/646/746/846/946"</span>,</span>
<span>                       <span class="st">"Salvia rosmarinus:114/1114"</span><span class="op">)</span> </span></code></pre></div>
<p>We now build a data frame with group names and codes, by merging the
information of these two groups of taxa. We also separate group names
from the set of codes defining the group into columns of a data
frame:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"Groups"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">genus_level</span>,</span>
<span>                                     <span class="va">assimilated_species</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html" class="external-link">separate</a></span><span class="op">(</span><span class="st">"Groups"</span>, into<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"group_names"</span>, <span class="st">"group_codes"</span><span class="op">)</span>, sep<span class="op">=</span><span class="st">":"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">groups_df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        group_names               group_codes</span></span>
<span><span class="co">## 1      Acacia spp.                 7/207/307</span></span>
<span><span class="co">## 2 Adenocarpus spp. 1163/2163/2103/3163/10103</span></span>
<span><span class="co">## 3    Anagyris spp.                  175/1175</span></span>
<span><span class="co">## 4    Atriplex spp.                       133</span></span>
<span><span class="co">## 5   Artemisia spp.         126/159/1159/3159</span></span>
<span><span class="co">## 6   Asparagus spp.             138/1138/2138</span></span></code></pre>
<p>We now filter out from the species data frame those that are already
included as part of species groups</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">in_groups</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">groups_df</span><span class="op">$</span><span class="va">group_codes</span>, split<span class="op">=</span><span class="st">"/"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sel</span> <span class="op">=</span> <span class="op">!</span><span class="op">(</span><span class="va">IFN_species_data</span><span class="op">$</span><span class="va">IFNCODE</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">in_groups</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">sel</span><span class="op">)</span>, <span class="st">" codes found in groups.\n"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 327 codes found in groups.</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IFN_species_unique</span> <span class="op">&lt;-</span> <span class="va">IFN_species_data</span><span class="op">[</span><span class="va">sel</span>, <span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-species-mapping-data-frame">Create species mapping data frame<a class="anchor" aria-label="anchor" href="#create-species-mapping-data-frame"></a>
</h2>
<p>Once we have IFN species names and codes, as well as the definition
of the IFN biological entities to merge, we can create the mapping data
frame using:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IFN_species_mapping</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">IFN_species_unique</span><span class="op">$</span><span class="va">IFNNAME</span>, <span class="va">groups_df</span><span class="op">$</span><span class="va">group_names</span><span class="op">)</span>,</span>
<span>                                  Codes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">IFN_species_unique</span><span class="op">$</span><span class="va">IFNCODE</span>, <span class="va">groups_df</span><span class="op">$</span><span class="va">group_codes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">IFN_species_mapping</span> <span class="op">&lt;-</span> <span class="va">IFN_species_mapping</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">IFN_species_mapping</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>,, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></code></pre></div>
<p>The resulting data frame has 217 entities and looks like:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">IFN_species_mapping</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                    Name      Codes</span></span>
<span><span class="co">## 16           Abies alba         31</span></span>
<span><span class="co">## 17        Abies pinsapo         32</span></span>
<span><span class="co">## 122         Acacia spp.  7/207/307</span></span>
<span><span class="co">## 194      Acer campestre 76/776/976</span></span>
<span><span class="co">## 81  Acer monspessulanum        276</span></span>
<span><span class="co">## 87         Acer negundo        376</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Víctor Granda, Adriana Tovar, Antoine Cabon, Nicolas Martin-StPaul, Arsène Druel.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
