<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Building forest input • medfateutils</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Building forest input">
<meta property="og:description" content="medfateutils">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medfateutils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Building forest input</h1>
                        <h4 data-toc-skip class="author">Miquel De
Cáceres</h4>
            
            <h4 data-toc-skip class="date">2022-05-10</h4>
      
      
      <div class="hidden name"><code>BuildingForestInput.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="goals">Goals<a class="anchor" aria-label="anchor" href="#goals"></a>
</h2>
<p>In this vignette we show how to build an object of class
<code>forest</code>, for its use in package medfate, from a table
containing forest inventory data. The vignette illustrates some common
issues that arise in the process, so that the user is aware of them when
processing his/her own data.</p>
<p>We begin by loading packages <strong>medfate</strong> and
<strong>medfateutils</strong>. Since the former is a dependency of the
latter, a single call to <code>library</code> is enough:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">medfateutils</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: medfate</span>
<span class="co">#&gt; Package 'medfate' [ver. 2.7.3]</span>
<span class="co">#&gt; Registered S3 method overwritten by 'ape':</span>
<span class="co">#&gt;   method   from </span>
<span class="co">#&gt;   plot.mst spdep</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="building-a-forest-input-poblet-oak-forest">Building a forest input Poblet oak forest<a class="anchor" aria-label="anchor" href="#building-a-forest-input-poblet-oak-forest"></a>
</h2>
<p>Package <code>medfateutils</code> includes a small dataset of tree
data, corresponding to a dense holm oak forest in Poblet (Catalonia,
Spain). As a result of the abandonment of previous coppicing
exploitation, there is a high density of stems per individual.</p>
<div class="section level3">
<h3 id="poblet-tree-data-set">Poblet tree data set<a class="anchor" aria-label="anchor" href="#poblet-tree-data-set"></a>
</h3>
<p>We begin by loading the tree data from Poblet:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"poblet_trees"</span><span class="op">)</span></code></pre></div>
<p>and we inspect its content, for example using:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">)</span>
<span class="co">#&gt;   Plot.Code Indv.Ref             Species Diameter.cm</span>
<span class="co">#&gt; 1  POBL_CTL        1 Acer monspessulanum         7.6</span>
<span class="co">#&gt; 2  POBL_CTL        2       Arbutus unedo         7.5</span>
<span class="co">#&gt; 3  POBL_CTL        3       Arbutus unedo         7.5</span>
<span class="co">#&gt; 4  POBL_CTL        4       Arbutus unedo         7.5</span>
<span class="co">#&gt; 5  POBL_CTL        5       Arbutus unedo         7.5</span>
<span class="co">#&gt; 6  POBL_CTL        6       Arbutus unedo         7.5</span></code></pre></div>
<p>The data frame includes tree data corresponding to three forest
inventories:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     POBL_CTL POBL_THI_AFT POBL_THI_BEF </span>
<span class="co">#&gt;          267          189          261</span></code></pre></div>
<p><code>POBL_CTL</code> corresponds to an oak forest where no treatment
was done (control), whereas <code>POBL_THI_BEF</code> and
<code>POBL_THI_AFT</code> are two forest inventories conducted on the
same forest plot, before and after a thinning intervention to reduce the
number of stems.</p>
</div>
<div class="section level3">
<h3 id="mapping-tree-data-from-the-control-forest">Mapping tree data from the control forest<a class="anchor" aria-label="anchor" href="#mapping-tree-data-from-the-control-forest"></a>
</h3>
<p>We initialize an empty forest object using function
<code><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">emptyforest()</a></code> from package <strong>medfate</strong>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_ctl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">emptyforest</a></span><span class="op">(</span><span class="st">"POBL_CTL"</span><span class="op">)</span>
<span class="va">forest_ctl</span>
<span class="co">#&gt; $ID</span>
<span class="co">#&gt; [1] "POBL_CTL"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $patchsize</span>
<span class="co">#&gt; [1] 10000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $treeData</span>
<span class="co">#&gt; [1] Species DBH     Height  N       Z50     Z95    </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $shrubData</span>
<span class="co">#&gt; [1] Species Height  Cover   Z50     Z95    </span>
<span class="co">#&gt; &lt;0 rows&gt; (or 0-length row.names)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $herbCover</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $herbHeight</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "forest" "list"</span></code></pre></div>
<p>Now we will fill in data for element <code>treeData</code> in the
<code>forest</code> object. For that, we need to define a mapping from
column names in <code>poblet_trees</code> to variables in
<code>treeData</code>. The mapping can be defined using a <strong>named
string vector</strong>, i.e. a vector where element names are variable
names in <code>treeData</code> and vector elements are strings of the
variable names in <code>poblet_trees</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapping</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species.name"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"DBH"</span> <span class="op">=</span> <span class="st">"Diameter.cm"</span><span class="op">)</span></code></pre></div>
<p>We can now replace the empty <code>treeData</code> in
<code>forest_ctl</code> using function
<code><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable()</a></code> from
<strong>medfateutils</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span>,<span class="op">]</span>, 
                                           mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span><span class="op">)</span></code></pre></div>
<p>We can inspect the result using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_ctl</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span>
<span class="co">#&gt;     Species            N      Height             DBH          Z50         </span>
<span class="co">#&gt;  Min.   :  4.0   Min.   :1   Mode:logical   Min.   : 7.50   Mode:logical  </span>
<span class="co">#&gt;  1st Qu.: 19.0   1st Qu.:1   NA's:267       1st Qu.: 9.00   NA's:267      </span>
<span class="co">#&gt;  Median :168.0   Median :1                  Median :10.70                 </span>
<span class="co">#&gt;  Mean   :105.3   Mean   :1                  Mean   :11.53                 </span>
<span class="co">#&gt;  3rd Qu.:168.0   3rd Qu.:1                  3rd Qu.:13.30                 </span>
<span class="co">#&gt;  Max.   :168.0   Max.   :1                  Max.   :26.00                 </span>
<span class="co">#&gt;    Z95         </span>
<span class="co">#&gt;  Mode:logical  </span>
<span class="co">#&gt;  NA's:267      </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt; </span></code></pre></div>
<p>Some data are missing, but we will not worry about it now. One way to
evaluate if the tree data is correctly specified is to display a summary
of the <code>forest</code> object using the <code>summary</code>
function defined in <strong>medfate</strong> for this object class:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span>
<span class="co">#&gt; Tree density (ind/ha): 267 </span>
<span class="co">#&gt; Tree BA (m2/ha): 3.0179815 </span>
<span class="co">#&gt; Cover (%) trees (open ground): 42.1205627  shrubs: 0 </span>
<span class="co">#&gt; Shrub crown phytovolume (m3/m2): 0 </span>
<span class="co">#&gt; LAI (m2/m2) total: 0.530447  trees: 0.530447  shrubs: 0 </span>
<span class="co">#&gt; Live fine fuel (kg/m2) total: 0.1372838  trees: 0.1372838  shrubs: 0 </span>
<span class="co">#&gt; PAR ground (%): NA  SWR ground (%): NA</span></code></pre></div>
<p>The values of stand density and stand basal area are too low for such
a dense forest, which indicates that something needs to be corrected. At
this point, it is important to remember that <code>forest</code> objects
need the density of trees to be specified as <em>stems per hectare</em>.
We conducted our tree data mapping without indicating the area of the
sampled plot. We are told that forest stand sampling was done using a
circular plot whose radius was 15 m. We can calculate the sampled area
using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sampled_area</span> <span class="op">=</span> <span class="va">pi</span><span class="op">*</span><span class="fl">15</span><span class="op">^</span><span class="fl">2</span></code></pre></div>
<p>and use this information to map the tree data again, where we specify
parameter <code>plot.size</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span>,<span class="op">]</span>, 
                                           mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, 
                                           plot.size <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></code></pre></div>
<p>We run again the summary:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span>
<span class="co">#&gt; Tree density (ind/ha): 3777.27731604765 </span>
<span class="co">#&gt; Tree BA (m2/ha): 42.6957047 </span>
<span class="co">#&gt; Cover (%) trees (open ground): 100  shrubs: 0 </span>
<span class="co">#&gt; Shrub crown phytovolume (m3/m2): 0 </span>
<span class="co">#&gt; LAI (m2/m2) total: 6.7141704  trees: 6.7141704  shrubs: 0 </span>
<span class="co">#&gt; Live fine fuel (kg/m2) total: 1.7424533  trees: 1.7424533  shrubs: 0 </span>
<span class="co">#&gt; PAR ground (%): NA  SWR ground (%): NA</span></code></pre></div>
<p>which results in a much higher basal area and density, as should be
expected for a dense oak forest resulting from an abandoned old
coppice.</p>
<p>Another issue that we see is the percentage of PAR and SWR that
reaches the ground, which have missing values. This indicates that
medfate cannot calculate the light extinction profile, in our case
because tree heights are missing. Thus, we should somehow estimate tree
heights, for example using an allometric relationship:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Height.cm</span> <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="fl">1.806</span><span class="op">*</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Diameter.cm</span><span class="op">^</span><span class="fl">0.518</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Height.cm</span><span class="op">)</span>
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;   512.9   566.9   628.3   638.0   692.7   976.5</span></code></pre></div>
<p>So trees are between 5 and 10 m height. Once tree heights are
defined, we can include them in our mapping:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapping</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Species.name"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"DBH"</span> <span class="op">=</span> <span class="st">"Diameter.cm"</span>,
            <span class="st">"Height"</span> <span class="op">=</span> <span class="st">"Height.cm"</span><span class="op">)</span></code></pre></div>
<p>and rerun the tree data mapping:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_ctl</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_CTL"</span>,<span class="op">]</span>, 
                                           mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, 
                                           plot.size <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span></code></pre></div>
<p>Now the summary of the control forest stand looks like:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_ctl</span>, <span class="va">SpParamsMED</span><span class="op">)</span>
<span class="co">#&gt; Tree density (ind/ha): 3777.27731604765 </span>
<span class="co">#&gt; Tree BA (m2/ha): 42.6957047 </span>
<span class="co">#&gt; Cover (%) trees (open ground): 100  shrubs: 0 </span>
<span class="co">#&gt; Shrub crown phytovolume (m3/m2): 0 </span>
<span class="co">#&gt; LAI (m2/m2) total: 6.7141704  trees: 6.7141704  shrubs: 0 </span>
<span class="co">#&gt; Live fine fuel (kg/m2) total: 1.7424533  trees: 1.7424533  shrubs: 0 </span>
<span class="co">#&gt; PAR ground (%): 2.4902336  SWR ground (%): 6.4867878</span></code></pre></div>
<p>The fraction of PAR/SWR reaching the ground is low, as would be
expected for a dense forest.</p>
</div>
<div class="section level3">
<h3 id="mapping-tree-data-from-the-managed-forest">Mapping tree data from the managed forest<a class="anchor" aria-label="anchor" href="#mapping-tree-data-from-the-managed-forest"></a>
</h3>
<p>Here we can repeat our mapping for the managed forest plot, which has
two codes corresponding to before and after the thinning intervention.
Let us first address the pre-thinning state:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_thi_bef</span> <span class="op">=</span> <span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">emptyforest</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">forest_thi_bef</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_BEF"</span>,<span class="op">]</span>, 
                                mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, 
                                plot.size <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_thi_bef</span><span class="op">$</span><span class="va">treeData</span><span class="op">)</span>
<span class="co">#&gt;     Species            N             Height           DBH          Z50         </span>
<span class="co">#&gt;  Min.   :  4.0   Min.   :14.15   Min.   :512.9   Min.   : 7.50   Mode:logical  </span>
<span class="co">#&gt;  1st Qu.: 19.0   1st Qu.:14.15   1st Qu.:563.7   1st Qu.: 9.00   NA's:261      </span>
<span class="co">#&gt;  Median :168.0   Median :14.15   Median :628.3   Median :11.10                 </span>
<span class="co">#&gt;  Mean   :114.5   Mean   :14.15   Mean   :635.5   Mean   :11.51                 </span>
<span class="co">#&gt;  3rd Qu.:168.0   3rd Qu.:14.15   3rd Qu.:681.9   3rd Qu.:13.00                 </span>
<span class="co">#&gt;  Max.   :168.0   Max.   :14.15   Max.   :944.9   Max.   :24.40                 </span>
<span class="co">#&gt;  NA's   :2                                                                     </span>
<span class="co">#&gt;    Z95         </span>
<span class="co">#&gt;  Mode:logical  </span>
<span class="co">#&gt;  NA's:261      </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt;                </span>
<span class="co">#&gt; </span></code></pre></div>
<p>Note that the <code>Species</code> variable contains two missing
values. This will normally happen when some species cannot be
identified. We can verify if this happens for other parts of the Poblet
tree data:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">SpParamsMED</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 4</span></code></pre></div>
<p>If we display species counts we can identify which species is not
being parsed:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Acer monspessulanum       Arbutus unedo Phillyrea latifolia     Quercus humilis </span>
<span class="co">#&gt;                   2                 265                   6                   4 </span>
<span class="co">#&gt;        Quercus ilex </span>
<span class="co">#&gt;                 440</span></code></pre></div>
<p>In this case, the name used for the downy oak (<em>Quercus
humilis</em>) is a synonym and needs to be replaced by^ its accepted
name (<em>Quercus pubescens</em>), which we can do:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Species</span><span class="op">==</span><span class="st">"Quercus humilis"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Quercus pubescens"</span></code></pre></div>
<p>Now we repeat our mapping:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_thi_bef</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_BEF"</span>,<span class="op">]</span>, 
                                mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, 
                                plot.size <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_thi_bef</span>, <span class="va">SpParamsMED</span><span class="op">)</span>
<span class="co">#&gt; Tree density (ind/ha): 3692.39467973197 </span>
<span class="co">#&gt; Tree BA (m2/ha): 40.9224267 </span>
<span class="co">#&gt; Cover (%) trees (open ground): 100  shrubs: 0 </span>
<span class="co">#&gt; Shrub crown phytovolume (m3/m2): 0 </span>
<span class="co">#&gt; LAI (m2/m2) total: 6.5530107  trees: 6.5530107  shrubs: 0 </span>
<span class="co">#&gt; Live fine fuel (kg/m2) total: 1.6994566  trees: 1.6994566  shrubs: 0 </span>
<span class="co">#&gt; PAR ground (%): 2.7210404  SWR ground (%): 6.9269881</span></code></pre></div>
<p>Like the control plot, these statistics indicate a dense oak forest.
We can repeat the same operations with the forest plot after the
thinning intervention:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">forest_thi_aft</span> <span class="op">=</span> <span class="fu"><a href="https://emf-creaf.github.io/medfate/reference/forest.html" class="external-link">emptyforest</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">forest_thi_aft</span><span class="op">$</span><span class="va">treeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/forest_mapWoodyTables.html">forest_mapTreeTable</a></span><span class="op">(</span><span class="va">poblet_trees</span><span class="op">[</span><span class="va">poblet_trees</span><span class="op">$</span><span class="va">Plot.Code</span><span class="op">==</span><span class="st">"POBL_THI_AFT"</span>,<span class="op">]</span>, 
                                mapping <span class="op">=</span> <span class="va">mapping</span>, SpParams <span class="op">=</span> <span class="va">SpParamsMED</span>, 
                                plot.size <span class="op">=</span> <span class="va">sampled_area</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">forest_thi_aft</span>, <span class="va">SpParamsMED</span><span class="op">)</span>
<span class="co">#&gt; Tree density (ind/ha): 2673.80304394384 </span>
<span class="co">#&gt; Tree BA (m2/ha): 31.6162035 </span>
<span class="co">#&gt; Cover (%) trees (open ground): 100  shrubs: 0 </span>
<span class="co">#&gt; Shrub crown phytovolume (m3/m2): 0 </span>
<span class="co">#&gt; LAI (m2/m2) total: 5.0833939  trees: 5.0833939  shrubs: 0 </span>
<span class="co">#&gt; Live fine fuel (kg/m2) total: 1.3224411  trees: 1.3224411  shrubs: 0 </span>
<span class="co">#&gt; PAR ground (%): 6.1061933  SWR ground (%): 12.6058106</span></code></pre></div>
<p>Note the decrease in tree density and basal area, and the increase in
light reaching the ground, despite the estimated leaf area index is
still high.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Miquel De Cáceres, Víctor Granda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
